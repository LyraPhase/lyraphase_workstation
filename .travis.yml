language: generic

sudo: false

env:
  global:
  - PATH="/opt/chefdk/bin:/opt/chef/bin:/opt/chef/embedded/bin:/opt/chefdk/embedded/bin:$PATH"
  - EL_CAPITAN_FAUXHAI='/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/fauxhai-2.3.0/lib/fauxhai/platforms/mac_os_x/10.11.1.json'

addons:
  apt:
    sources:
    - chef-stable-precise
    packages:
    - chefdk
    - liblzma
    - zlib1g
    - libxml2
    - libxslt1
    - liblzma-dev
    - zlib1g-dev
    - libxml2-dev
    - libxslt1-dev

before_script:
  - ls -lR /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/
  - bash -c '[ -e $EL_CAPITAN_FAUXHAI ] || curl -o $EL_CAPITAN_FAUXHAI https://raw.githubusercontent.com/customink/fauxhai/master/lib/fauxhai/platforms/mac_os_x/10.11.1.json'
  - eval "$(chef shell-init $(basename $SHELL))"

script:
  - rake knife
  - rake foodcritic
  - rake chefspec

