language: generic

sudo: false

env:
  global:
  - PATH="/opt/chefdk/bin:/opt/chef/bin:/opt/chef/embedded/bin:/opt/chefdk/embedded/bin:$PATH"

addons:
  apt:
    sources:
    - chef-stable-precise
    packages:
    - chefdk
    - liblzma-dev
    - zlib1g-dev

before_script:
  - chef exec bundle config build.nokogiri --use-system-libraries --with-opt-include /opt/chefdk/embedded/include --with-opt-lib /opt/chefdk/embedded/lib
  - chef exec bundle --without='task_runners development kitchen_cloud kitchen_vagrant task_runners' update fauxhai chefspec
  - chef exec bundle --without='task_runners development kitchen_cloud kitchen_vagrant task_runners' install
  - eval "$(chef shell-init $(basename $SHELL))"

script:
  - rake knife
  - rake foodcritic
  - rake chefspec

