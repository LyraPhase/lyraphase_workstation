language: generic

sudo: false

env:
  global:
  - PATH="/opt/chefdk/bin:/opt/chef/bin:/opt/chef/embedded/bin:/opt/chefdk/embedded/bin:$PATH"

addons:
  apt:
    sources:
    - chef-stable-precise
    packages:
    - chefdk
    - liblzma
    - zlib1g
    - libxml2
    - libxslt1
    - liblzma-dev
    - zlib1g-dev
    - libxml2-dev
    - libxslt1-dev

before_script:
#  - chef exec bundle config build.nokogiri "--use-system-libraries --with-opt-include=/opt/chefdk/embedded/include --with-opt-lib=/opt/chefdk/embedded/lib --with-xml2-lib=/opt/chefdk/embedded/lib --with-xml2-include=/opt/chefdk/embedded/include/libxml2 --with-xslt-lib=/opt/chefdk/embedded/lib --with-xslt-include=/opt/chefdk/embedded/include/libxslt --with-iconv-dir=/opt/chefdk/embedded --with-zlib-dir=/opt/chefdk/embedded"
  - chef exec bundle config build.nokogiri --use-system-libraries
  - cat ~/.bundle/config
  - bash -c "bash -c 'chef exec bundle --without='task_runners development kitchen_cloud kitchen_vagrant task_runners' update fauxhai chefspec ; exit 0' ; exit 0"
  - ls -l /home/travis/.chefdk/gem/ruby/2.1.0/extensions/x86_64-linux/2.1.0/nokogiri-1.6.7/
  - cat /home/travis/.chefdk/gem/ruby/2.1.0/extensions/x86_64-linux/2.1.0/nokogiri-1.6.7/mkmf.log
  - chef exec bundle --without='task_runners development kitchen_cloud kitchen_vagrant task_runners' install
  - eval "$(chef shell-init $(basename $SHELL))"

script:
  - rake knife
  - rake foodcritic
  - rake chefspec

